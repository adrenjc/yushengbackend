# ğŸš€ åç«¯ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç¯å¢ƒé…ç½®

### ğŸ¯ ä¸åŒç¯å¢ƒçš„å¯åŠ¨æ–¹å¼

#### ğŸ”§ å¼€å‘ç¯å¢ƒ

```bash
# ç›´æ¥å¯åŠ¨ï¼ˆå•è¿›ç¨‹ï¼Œçƒ­é‡è½½ï¼‰
npm run dev

# ä½¿ç”¨PM2å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆæ”¯æŒç›‘æ§ï¼‰
npm run pm2:dev
```

#### ğŸŒ ç”Ÿäº§ç¯å¢ƒ

```bash
# ä½¿ç”¨PM2å¯åŠ¨ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰
npm run prod

# æˆ–è€…ç›´æ¥ä½¿ç”¨PM2å‘½ä»¤
npm run pm2:start

# å•è¿›ç¨‹ç”Ÿäº§å¯åŠ¨ï¼ˆä¸æ¨èï¼‰
npm run start:prod
```

## ğŸ› ï¸ å®Œæ•´éƒ¨ç½²æµç¨‹

### 1ï¸âƒ£ é¦–æ¬¡éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. å®‰è£…cross-envï¼ˆå¦‚æœéœ€è¦ï¼‰
npm install --save-dev cross-env

# 3. åˆå§‹åŒ–æ•°æ®åº“
npm run setup

# 4. å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
npm run prod
```

### 2ï¸âƒ£ æ›´æ–°éƒ¨ç½²

```bash
# å¿«é€Ÿæ›´æ–°éƒ¨ç½²
npm run deploy:update

# æˆ–è€…æ‰‹åŠ¨æ­¥éª¤ï¼š
git pull
npm install
npm run pm2:reload
```

## ğŸ” PM2 ç®¡ç†å‘½ä»¤

### ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

```bash
# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
npm run pm2:monit

# æŸ¥çœ‹æ—¥å¿—
npm run pm2:logs

# æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
pm2 list
```

### âš¡ è¿›ç¨‹ç®¡ç†

```bash
# é‡å¯æœåŠ¡
npm run pm2:restart

# ä¼˜é›…é‡è½½ï¼ˆé›¶åœæœºï¼‰
npm run pm2:reload

# åœæ­¢æœåŠ¡
npm run pm2:stop

# åˆ é™¤è¿›ç¨‹
npm run pm2:delete
```

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒç‰¹æ€§

### âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®

- **å¤šè¿›ç¨‹é›†ç¾¤**ï¼šè‡ªåŠ¨ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
- **è‡ªåŠ¨é‡å¯**ï¼šè¿›ç¨‹å´©æºƒè‡ªåŠ¨é‡å¯
- **å†…å­˜ç›‘æ§**ï¼šè¶…è¿‡ 2GB è‡ªåŠ¨é‡å¯
- **ä¼˜é›…å…³é—­**ï¼šæ”¯æŒé›¶åœæœºæ›´æ–°
- **æ—¥å¿—ç®¡ç†**ï¼šç»“æ„åŒ–æ—¥å¿—è®°å½•
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå†…å­˜å’Œ GC ä¼˜åŒ–

### ğŸ“ ç¯å¢ƒå˜é‡

```bash
NODE_ENV=production
PORT=8080
```

### ğŸ”§ PM2 é…ç½®äº®ç‚¹

```javascript
{
  instances: "max",           // ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
  exec_mode: "cluster",       // é›†ç¾¤æ¨¡å¼
  max_memory_restart: "2G",   // å†…å­˜é™åˆ¶
  autorestart: true,          // è‡ªåŠ¨é‡å¯
  watch: false,               // ç”Ÿäº§ç¯å¢ƒå…³é—­æ–‡ä»¶ç›‘æ§
}
```

## ğŸŒ nginx é…ç½®ç¡®è®¤

ç¡®ä¿ nginx æ­£ç¡®ä»£ç†åˆ°åç«¯ï¼š

```nginx
upstream smart_match_backend {
    server 127.0.0.1:8080;
}

location /api/ {
    proxy_pass http://smart_match_backend;
    # ... å…¶ä»–é…ç½®
}
```

## ğŸ” æ•…éšœæ’æŸ¥

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œ
pm2 list

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8080

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/combined.log
```

### å¸¸è§é—®é¢˜è§£å†³

1. **ç«¯å£è¢«å ç”¨**

   ```bash
   # æŸ¥æ‰¾å ç”¨è¿›ç¨‹
   lsof -i :8080
   # æ€æ­»è¿›ç¨‹
   kill -9 <PID>
   ```

2. **å†…å­˜ä¸è¶³**

   ```bash
   # æŸ¥çœ‹å†…å­˜ä½¿ç”¨
   free -h
   # è°ƒæ•´PM2å†…å­˜é™åˆ¶
   # ç¼–è¾‘ ecosystem.config.js ä¸­çš„ max_memory_restart
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MongoDBçŠ¶æ€
   sudo systemctl status mongod
   # æ£€æŸ¥RedisçŠ¶æ€
   sudo systemctl status redis
   ```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ğŸš€ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

1. **ä½¿ç”¨ PM2 é›†ç¾¤æ¨¡å¼**ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU
2. **è®¾ç½®åˆç†çš„å†…å­˜é™åˆ¶**ï¼šé¿å…å†…å­˜æ³„æ¼
3. **é…ç½®æ—¥å¿—è½®è½¬**ï¼šé˜²æ­¢æ—¥å¿—æ–‡ä»¶è¿‡å¤§
4. **ç›‘æ§èµ„æºä½¿ç”¨**ï¼šå®šæœŸæ£€æŸ¥ CPU å’Œå†…å­˜
5. **å®šæœŸé‡å¯**ï¼šå¯é…ç½®å®šæ—¶é‡å¯ç­–ç•¥

### ğŸ“Š ç›‘æ§å»ºè®®

```bash
# è®¾ç½®PM2æŒä¹…åŒ–
pm2 startup
pm2 save

# å®‰è£…PM2ç›‘æ§ï¼ˆå¯é€‰ï¼‰
pm2 install pm2-server-monit
```

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ç¯å¢ƒå˜é‡å®‰å…¨**ï¼šæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
2. **æ–‡ä»¶æƒé™**ï¼šç¡®ä¿æ—¥å¿—ç›®å½•æƒé™æ­£ç¡®
3. **è¿›ç¨‹ç”¨æˆ·**ï¼šä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ
4. **é˜²ç«å¢™é…ç½®**ï¼šåªå¼€æ”¾å¿…è¦ç«¯å£
5. **SSL è¯ä¹¦**ï¼šç¡®ä¿ nginx SSL é…ç½®æ­£ç¡®

---

## ğŸ‰ å¿«é€Ÿå¯åŠ¨å‘½ä»¤

```bash
# ğŸ”¥ ç”Ÿäº§ç¯å¢ƒä¸€é”®å¯åŠ¨
npm run prod

# ğŸ“Š æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
npm run pm2:monit

# ğŸ“ æŸ¥çœ‹æ—¥å¿—
npm run pm2:logs
```
